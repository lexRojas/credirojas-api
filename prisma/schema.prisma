// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// ===== Enums =====
enum Modalidad {
  ALEMAN
  FRANCES
}

enum TipoCuota {
  ORDINARIA
  ADICIONAL
}

/// ===== Tablas =====


model Usuario {
  idUsuario Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  rolId     Int?
  rol              Rol?       @relation(fields: [rolId], references: [idRol], onUpdate: Cascade)
  socio   Socio? @relation(fields: [idSocio], references: [idSocio], onUpdate: Cascade, onDelete: SetNull)
  idSocio          Int?       @unique
  
  @@index([rolId])
  
    @@map("usuario")
}

model Variables {
  idVariable   Int      @id @default(autoincrement())
  descripcion  String   @unique
  valor        Decimal  @db.Decimal(14, 4)

  @@map("variables")
}

model Rol {
  idRol        Int      @id @default(autoincrement())
  descripcion  String
  usuarios     Usuario[]

  @@map("rol")
}

model Socio {
  idSocio          Int        @id @default(autoincrement())
  cedula           String?     
  nombre           String
  fechaNacimiento  String?
  fechaIngreso     String?
  fechaSalida      String?
  montoAccion      Decimal?   @db.Decimal(14, 4)
  multiplicador    Int?       // si quieres decimales, cámbialo a Decimal @db.Decimal(14,4)
  
  

  // Relaciones
  prestamos        Prestamo[]
  acciones         Accion[]
  pagos            Pago[]
  solicitudes      Solicitud[]
  votos            Votacion[]
  usuario          Usuario?

  @@index([cedula])  
  @@map("socio")
}

model Accion {
  idAccion            Int       @id @default(autoincrement())
  socioId             Int
  fecha               String
  monto_colones       Decimal   @db.Decimal(14, 4)
  cantidadAcciones    Int       // número de acciones del monto depositado
  periodo             String?   // ej: "2025-08" o el formato que definas
  pesoMultiplicador   Int?      // número de meses que trabaja ese monto

  socio               Socio     @relation(fields: [socioId], references: [idSocio], onDelete: Cascade, onUpdate: Cascade)

  @@index([socioId])
  @@map("accion")
}

model Prestamo {
  idPrestamo               Int        @id @default(autoincrement())
  socioId                  Int
  monto                    Decimal    @db.Decimal(14, 4)
  plazo                    Int        // meses
  motivo                   String?
  modalidad                Modalidad
  saldoCapital             Decimal    @db.Decimal(14, 4)
  saldoInteresOrdinario    Decimal    @db.Decimal(14, 4)
  saldoInteresMoratorio    Decimal    @db.Decimal(14, 4)

  socio                    Socio      @relation(fields: [socioId], references: [idSocio], onDelete: Cascade, onUpdate: Cascade)
  pagos                    Pago[]

  @@index([socioId])
  @@map("prestamo")
}

model Pago {
  idPago               Int       @id @default(autoincrement())
  socioId              Int
  prestamoId           Int?
  fechaProyectada      String
  fechaReal            String?
  diasAtraso           Int?      // puedes calcularlo en app o trigger
  monto                Decimal   @db.Decimal(14, 4)
  interesOrdinario     Decimal   @db.Decimal(14, 4)
  tipoCuota            TipoCuota
  interesExtraordinario Decimal? @db.Decimal(14, 4)

  socio                Socio     @relation(fields: [socioId], references: [idSocio], onDelete: Cascade, onUpdate: Cascade)
  prestamo             Prestamo? @relation(fields: [prestamoId], references: [idPrestamo], onDelete: SetNull, onUpdate: Cascade)

  @@index([socioId])
  @@index([prestamoId])
  @@map("pagos")
}

model Solicitud {
  idSolicitud      Int        @id @default(autoincrement())
  socioId          Int
  fechaSolicitud   String
  detalle          String?
  aprobada         Boolean    @default(false)
  fechaAprobacion  String?
  cerrada          Boolean    @default(false)

  socio            Socio      @relation(fields: [socioId], references: [idSocio], onDelete: Cascade, onUpdate: Cascade)
  votos            Votacion[]

  @@index([socioId])
  @@map("solicitudes")
}

model Votacion {
  idVoto        Int        @id @default(autoincrement())
  socioId       Int
  solicitudId   Int
  fecha         String   // si quieres separar hora, puedes agregar campo string "hora"
  hora          String?    // opcional, si necesitas textual (HH:mm)
  observacion   String?
  aprueba       Boolean    @default(false)


  socio         Socio      @relation(fields: [socioId], references: [idSocio], onDelete: Cascade, onUpdate: Cascade)
  solicitud     Solicitud  @relation(fields: [solicitudId], references: [idSolicitud], onDelete: Cascade, onUpdate: Cascade)

  @@index([socioId])
  @@index([solicitudId])
  @@map("votacion")
}
